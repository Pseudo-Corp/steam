name: 'update-game-files'
on:
  schedule:
    - cron: '*/5 * * * *'

jobs:    
  check_hash:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3

      - name: Install deps
        run: sudo apt install -y zip
      - name: clone Pseudo-Corp/SynergismOfficial
        run: |
          git clone https://github.com/Pseudo-Corp/SynergismOfficial && cd SynergismOfficial && git checkout gh-pages
          zip -r ../Synergism.zip .
          cd ..
      - name: clone Pseudo-Corp/steam
        run: |
          git clone https://github.com/Pseudo-Corp/steam
          zip -r steam.zip steam/src
      - name: Compare equality
        run: |
          if cmp -s Synergism.zip steam.zip; then
            echo "CHANGED=false" >> $GITHUB_ENV
          else
            echo "CHANGED=true" >> $GITHUB_ENV
          fi
      - name: Update files
        if: env.CHANGED == 'true'
        run: |
          rm -rf ./steam/src
          cp -r SynergismOfficial steam/src
          cd steam
      - name: Upload files
        if: env.CHANGED == 'true'
        uses: EndBug/add-and-commit@v9
        with:
          add: 'src'
          default_author: github_actor
          fetch: false
          message: 'Update Synergism'
          pathspec_error_handling: ignore
          push: true
      - name: Cleanup
        run: |
          rm -rf steam steam.zip SynergismOfficial Synergism.zip

